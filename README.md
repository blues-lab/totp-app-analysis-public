# Security and Privacy Failures in Popular 2FA Apps
This repository contains the paper titled `Security and Privacy Failures in
Popular 2FA Apps`, which has been accepted to [USENIX Security
2023](https://www.usenix.org/conference/usenixsecurity23/presentation/gilsenan),
and its supplemental materials and artifacts.

## Abstract and Paper

The Time-based One-Time Password (TOTP) algorithm is a 2FA method that is widely
deployed because of its relatively low implementation costs and purported
security benefits over SMS 2FA. However, users of TOTP 2FA apps face a critical
usability challenge: maintain access to the secrets stored within the TOTP app,
or risk getting locked out of their accounts. To help users avoid this fate,
popular TOTP apps implement a wide range of backup mechanisms, each with varying
security and privacy implications. In this paper, we define an assessment
methodology for conducting systematic security and privacy analyses of the
backup and recovery functionality of TOTP apps. We identified all general
purpose Android TOTP apps in the Google Play Store with at least 100k installs
that implemented a backup mechanism (n = 22). Our findings show that most backup
strategies end up placing trust in the same technologies that TOTP 2FA is meant
to supersede: passwords, SMS, and email. Many backup implementations shared
personal user information with third parties, had serious cryptographic flaws,
and/or allowed the app developers to access the TOTP secrets in plaintext. We
present our findings and recommend ways to improve the security and privacy of
TOTP 2FA app backup mechanisms.

The repo contains the [full paper
here](/Gilsenan%20et%20al%20-%20Security%20and%20Privacy%20Failures%20in%20Popular%202FA%20Apps.pdf)
and the [bibtex here](/bibtex.txt).

## USENIX'23 Artifact Appendix

We strove to make our work fully verifiable and reproducible. To that end, the
artifacts and related instructions in this repo are intended to allow
researchers to verify and fully reproduce the findings presented in the paper.

The artifacts available include:

- [Search Terms](search_terms.txt): The list of search terms that we used to
  identify as many TOTP apps in the Google Play Store as possible (see Section
  4.1 - App Selection).

- **App Checklists**: For each app, the customized checklist that enumerates
  exactly which actions to take within the app and which data to enter while
  recording the network traffic (see Section 4.2.1 - Exploring the App).

- **Decryption Scripts**: For each app that supports encrypted TOTP backups, the
  golang script that implements the decryption process (see Section 4.2.3 -
  Performing Cryptanalysis).

Along with the instructions in this README, the app checklists and decryption
scripts allow researchers to reproduce the findings reported Tables 1, 2, and 3
in the paper:

- **Table 1**: Overview of the backup mechanisms supported in each app.
- **Table 2**: Overview of the backup mechanisms that automatically sync data to the cloud.
- **Table 3**: Cryptographic details of app backup mechanisms.

### Setup to capture traffic

Follow the [instructions here](capture-traffic/README.md) to setup your Android
phone and laptop to record the plaintext traffic generated by the TOTP apps
running on the phone.

### Capture & Review Network Traffic (Section 4.2.2)

During our research, we created a customized checklist that enumerated exactly
which actions to take within the app and which data to enter (e.g., phone
numbers, email addresses, and passwords) while recording the network traffic.
Each checklist included a core set of steps designed to replicate the real world
actions that a user would take when first using the app, enabling its backup
mechanism, and eventually executing the recovery process. We believe that a
reasonable user executing these steps would not expect any of their personal
information to be sent remotely in plaintext, unless they were informed.

The checklist for each app is available in the
`apps/<id@version>/logs/checklist.md` directory. Table 1 provides the APK id and
version, which allows you to download and install the same version of the app
that we analyzed in our work. The Google Play Store only allows downloading the
most recent release of an app, but you can get previous versions of an app from
mirror sites, such as [apkmirror.com](https://www.apkmirror.com/). Once the app
is installed, make sure that you are recording the plaintext network traffic
before you execute the steps in the checklist.

Executing the steps in the checklist will allow you to verify:

-  All of the backup mechanism categorizations in `Table 1` (except for Android
   Backup)
-  The following columns in Table 2: `PII to use cloud backups` and `Obtain
   Backup With..`
- The minimum password lengths listed in Table 3

The remaining entries in Table 2 can be verified by reviewing the network
traffic snippets that we collected from the captures during our research
(`apps/<id@version>/logs/traffic-snippet.txt`). These same entries can be
reproduced by analyzing your own network traffic recorded while executing the
steps in the checklist.

### Verify Cryptanalysis (Section 4.2.3)

Many of the apps that we analyzed implemented multiple features that relied on
various methods of cryptography. Therefore, we could not assume that our
observations and assumptions about the cryptography used to generate the
ciphertext in the TOTP backup were correct. To prove that we had identified the
correct cryptographic primitives and configurations, we implemented the app's
decryption process in a separate script. We manually verified whether the
decryption process was correctly implemented by looking for known values in the
resulting plaintext, such as the TOTP secret from our custom QR codes.

Researchers can verify our findings in Table 3 using the decryption script for
each app, which is available in the `apps/<id@version>/verify_crypto` directory.
These scripts are written in Go and require [Go 1.18 or
higher](https://go.dev/doc/install).

#### Running the decryption script
Each script has a section near the top that defines constant variables,
including:

1. the ciphertext and IV from the network traffic
2. if applicable, the password that used when enabling the backup mechanism
3. if applicable, any salt passed to a KDF

By default, the values for these constants are the actual values that we
observed in real network traffic generated by each app during our research.
Executing the script will verify our findings.

First, make sure all of the dependencies are downloaded:

```bash
$> go mod tidy
```

Then, execute the verification script:

```bash
$> go run verify_crypto.go
```

To reproduce our findings, you will need to update the relevant constants in
each script with the values present in your network traffic captures and/or file
exports. Each script is well commented to indicate where the value can be found
in the traffic or file. Additionally, we include the relevant network traffic
snippets that we collected from our own network traffic captures during our
research (`apps/<id@version>/logs/traffic-snippet.md`). These may be useful to
observe additional identifiers to help you find the correct requests/responses
and field values in your traffic captures.
